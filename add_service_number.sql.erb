DECLARE
  oper_id operators.id%type;
  sn_id service_numbers.id%type;
BEGIN
  BEGIN
    SELECT id
      INTO oper_id
      FROM operators
     WHERE name = '<%= @name %>'
       AND TO_CHAR(description) = '<%= @description %>'
       AND org_id = 99822
       AND rownum = 1;
  EXCEPTION WHEN NO_DATA_FOUND THEN
    INSERT INTO operators (name,description,standard_id,org_id,country_id,mcc,mnc,currency_id) VALUES ('<%= @name %>','<%= @description %>',1,99822,1,null,null,1) RETURNING id INTO oper_id;
  END;

  INSERT INTO service_numbers (module_name,snumber,operator_id,in_sms_price,out_sms_price,sms_charging_type_id,operator_share,mt_cost,recognize_1st_mt,cost_1st_mt) VALUES ('<%= @module_name %>','<%= @snumber %>',oper_id,'<%= @in_sms_price %>',0,1,'<%= @operator_share %>',0,null,null) RETURNING id INTO sn_id;

  INSERT INTO tariff_plans_snumbers (TARIFF_ID, SERVICE_NUMBER_ID) VALUES (51, sn_id);
  INSERT INTO tariff_plans_snumbers (TARIFF_ID, SERVICE_NUMBER_ID) VALUES (52, sn_id);
  INSERT INTO tariff_plans_snumbers (TARIFF_ID, SERVICE_NUMBER_ID) VALUES (53, sn_id);

  COMMIT;
END;
/
